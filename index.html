<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>ChatGPT Web Chat</title>
  <style>
    body { background:#0f1724; color:#e6eef6; font-family:Arial; }
    .chatbox { max-width:700px; margin:40px auto; background:#1c2233; padding:20px; border-radius:10px; }
    #chat { height:300px; overflow:auto; padding:10px; border:1px solid #333; border-radius:8px; background:#111827; }
    .msg { margin:8px 0; }
    .user { text-align:right; color:#7c3aed; }
    .bot { text-align:left; color:#9ca3af; }
    form { display:flex; margin-top:10px; }
    input { flex:1; padding:10px; border-radius:6px; border:none; margin-right:6px; }
    button { padding:10px 14px; border:none; border-radius:6px; background:#7c3aed; color:#fff; cursor:pointer; }
    .vars { font-size:14px; color:#9ca3af; margin-top:15px; }
  </style>
</head>
<body>
  <div class="chatbox">
    <h1>ChatGPT Chatbot</h1>
    <div id="chat"></div>
    <form id="form">
      <input id="input" type="text" placeholder="Say something..." autocomplete="off" required />
      <button>Send</button>
    </form>

    <!-- ChatGPT Variables -->
    <div class="vars">
      <label>Model:
        <select id="model">
          <option value="gpt-4o-mini">gpt-4o-mini</option>
          <option value="gpt-4o">gpt-4o</option>
          <option value="gpt-3.5-turbo">gpt-3.5-turbo</option>
        </select>
      </label>
      <label>Temperature:
        <input id="temp" type="number" min="0" max="2" step="0.1" value="0.7">
      </label>
      <label>Max Tokens:
        <input id="tokens" type="number" min="1" max="1000" value="300">
      </label>
    </div>
  </div>

<script>
const chat = document.getElementById('chat');
const form = document.getElementById('form');
const input = document.getElementById('input');
const modelSel = document.getElementById('model');
const tempSel = document.getElementById('temp');
const tokSel = document.getElementById('tokens');

let conversation = [
  { role: "system", content: "You are a helpful assistant." }
];

function addMsg(text, cls){
  const div = document.createElement('div');
  div.className = 'msg ' + cls;
  div.textContent = text;
  chat.appendChild(div);
  chat.scrollTop = chat.scrollHeight;
}

form.addEventListener('submit', async e=>{
  e.preventDefault();
  const text = input.value.trim();
  if(!text) return;
  addMsg("You: "+text,'user');
  input.value = '';

  conversation.push({role:'user', content:text});
  addMsg("Bot: …thinking…",'bot');

  try{
    const res = await fetch('/.netlify/functions/chat',{
      method:'POST',
      headers:{'Content-Type':'application/json'},
      body:JSON.stringify({
        messages: conversation,
        model: modelSel.value,
        temperature: parseFloat(tempSel.value),
        max_tokens: parseInt(tokSel.value)
      })
    });
    const data = await res.json();
    const reply = data.reply || "(No reply)";
    chat.lastChild.textContent = "Bot: " + reply;
    conversation.push({role:'assistant', content:reply});
  }catch(err){
    chat.lastChild.textContent = "Bot: (Error: "+err.message+")";
  }
});
</script>
</body>
</html>
